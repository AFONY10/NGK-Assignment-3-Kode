<html>
<head>
  <title> Client</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.3/js/tabulator.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.3/css/tabulator.min.css">

  <script type="text/javascript">
  
    const socket = new WebSocket('ws://localhost:8080/chat');
    
    socket.addEventListener('open', function (event) {
    socket.send('Hello Server!');
    });

    socket.addEventListener('message', function (message) {console.log('Message from server', message.data);
      document.getElementById("update").innerHTML = message.data;
    });
    
    getData();
    
    function setTable(data) {
      $("#table").tabulator({
        layout: "fitDataFill",
        height: "311px",
        columns: [
          {
            title: "ID",
            field: "ID",
          },
          {
            title: "Date",
            field: "Date",
          },
          {
            title: "Time",
            field: "Time",
          },
          {
            title: "Name",
            field: "Name",
          },
          {
            title: "Lat",
            field: "Lat",
          },
          {
            title: "Lon",
            field: "Lon",
          },
          {
            title: "Temperature",
            field: "Temperature",
          },
          {
            title: "Humidity",
            field: "Humidity",
          }
        ],
      });
      $("#table").tabulator("setData", data);
    }

    function getData() {
      axios
        .get("http://localhost:8080")
        .then((response) => {
          setTable(response.data);
        }).catch((error) => alert("Try again"));
    }

    function sendData() {

      axios.post("http://localhost:8080", {
        "ID": (document.getElementById("ID").value),
        "Date": (document.getElementById("Date").value),
        "Time": (document.getElementById("Time").value),
        "Name": (document.getElementById("Name").value),
        "Lat": (document.getElementById("Lat").value),
        "Lon": (document.getElementById("Lon").value),
        "Temperature": (document.getElementById("Temperature").value),
        "Humidity": (document.getElementById("Humidity").value)
      })
        .then((response) => { })
        .catch((error) => alert("Try again"));
        socket.send('ID: ' + (document.getElementById("ID").value) + ' added.');
    }

    function updateData(idnumber) {
      var url = "http://localhost:8080/" + idnumber

      axios.put(url,
        {
          "ID": (document.getElementById("ID").value),
          "Date": (document.getElementById("Date").value),
          "Time": (document.getElementById("Time").value),
          "Name": (document.getElementById("Name").value),
          "Lat": (document.getElementById("Lat").value),
          "Lon": (document.getElementById("Lon").value),
          "Temperature": (document.getElementById("Temperature").value),
          "Humidity": (document.getElementById("Humidity").value)
        })
        .then((response) => { })
        .catch((error) => alert("Try again"));
        socket.send('ID: ' + (document.getElementById("ID").value) + ' updated.');
    }

    function deleteById(idnumber) {
      var url = 'http://localhost:8080/' + idnumber

      axios.delete(url,
        {
          "ID": (document.getElementById("ID").value),
          "Date": (document.getElementById("Date").value),
          "Time": (document.getElementById("Time").value),
          "Name": (document.getElementById("Name").value),
          "Lat": (document.getElementById("Lat").value),
          "Lon": (document.getElementById("Lon").value),
          "Temperature": (document.getElementById("Temperature").value),
          "Humidity": (document.getElementById("Humidity").value)
        })
        .then(response => {
        }).catch(error => alert('Try again'));
        socket.send('ID: ' + (document.getElementById("ID").value) + ' deleted.');
    }

  </script>
</head>

<body>
  <h1>Weather Station</h1>

  <p>Id<input id="ID" type="text"></p>
  <p>Date<input id="Date" type="text"></p>
  <p>Time<input id="Time" type="text"></p>
  <p>Placename<input id="Name" type="text"></p>
  <p>Lat<input id="Lat" type="text"></p>
  <p>Lon<input id="Lon" type="text"></p>
  <p>Temperature<input id="Temperature" type="text"></p>
  <p>Humidity<input id="Humidity" type="text"></p>

  <input type="button" onclick="getData()" value="Get Data">
  
  <input type="button" onclick="sendData()" value="Send Data"><br>

  <p>Change Id<input id="lognr" type="text"></p>
  <input type="button" onclick="updateData(document.getElementById('lognr').value)" value="Update Data">
  <input type="button" onclick="deleteById(document.getElementById('lognr').value)" value="Delete Data">
  
  <br>
  <b> Action: </b>
  <i id="update">*Nothing*</i><br>
  
  <div id="table"> </div>


</body>
</html>
