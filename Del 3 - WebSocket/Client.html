<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta PlaceName="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vejrstation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        button {
            background-color: #4caf50;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
            display: inline-block;
        }

        button:hover {
            background-color: #45a049;
        }

        #opdatering {
            color: green;
            font-style: italic;
        }

        #table {
            margin-top: 20px;
        }
    </style>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.3/js/tabulator.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.3/css/tabulator.min.css">
    </link>
</head>

<body>
    <!-- Overskrift -->
    <h1>Vejrstation</h1>

    <!-- Formular for at indtaste data -->
    <label for="ID">ID:</label><input id="ID" type="text">
    <label for="Date">Date:</label><input id="Date" type="text">
    <label for="Time">Time:</label><input id="Time" type="text">
    <label for="PlaceName">PlaceName:</label><input id="PlaceName" type="text">
    <label for="Lat">Lat:</label><input id="Lat" type="text">
    <label for="Lon">Lon:</label><input id="Lon" type="text">
    <label for="Temperature">Temperature:</label><input id="Temperature" type="text">
    <label for="Humidity in %">Humidity in %:</label><input id="Humidity in %" type="text">

    <!-- Knapper til at udføre handlinger -->
    <button onclick="getData()">Hent Data</button>
    <button onclick="sendData()">Send Data</button>

    <!-- Tabel til at vise data -->
    <div id="tabel"></div>

    <!-- Formular til at ændre data baseret på ID -->
    <label for="lognr">Ændre ID:</label><input id="lognr" type="text">
    <button onclick="updateData(document.getElementById('lognr').value)">Opdater Data</button>
    <button onclick="deleteById(document.getElementById('lognr').value)">Slet Data</button>

    <br>
    <b> Action: </b>
    <i id="update">*Nothing*</i><br>

    <div id="table"> </div>

    <!-- Statusmeddelelse -->
    <p><b>Handling:</b> <i id="opdatering">*Ingenting*</i></p>
    <div id="wsupdate"></div>

    <script type="text/javascript">
        // WebSocket for communication with the server
        const socket = new WebSocket('ws://localhost:8080/chat');

        // Eventlistener for when the WebSocket connection opens
        socket.addEventListener('open', function (event) {

            // send message kode 
            socket.send('Hello server');
        });


        socket.addEventListener('message', function (message) {

            // wait for message
            document.getElementById("wsupdate").innerHTML = message.data

        });

        function getData() {
            axios
                .get("http://localhost:8080")
                .then((response) => {
                    setTable(response.data);
                }).catch((error) => alert("Try again"));
        }

    function sendData() {
    // Indsamle inputfelter
    var data = {
        "ID": document.getElementById("ID").value,
        "Date": document.getElementById("Date").value,
        "Time": document.getElementById("Time").value,
        "PlaceName": document.getElementById("PlaceName").value,
        "Lat": document.getElementById("Lat").value,
        "Lon": document.getElementById("Lon").value,
        "Temperature": document.getElementById("Temperature").value,
        "Humidity": document.getElementById("Humidity in %").value // Opdateret nøgle her
    };

    axios.post("http://localhost:8080", data)
        .then(response => {
            // Success - gør noget her, hvis nødvendigt
            console.log("Data sendt med succes:", response.data);
        })
        .catch(error => {
            // Fejl - vis en mere specifik fejlmeddelelse i konsollen
            console.error("Fejl ved afsendelse af data:", error);

            // Vis en brugervenlig fejlmeddelelse
            alert("Fejl ved afsendelse af data. Se konsollen for mere information.");
        });

    socket.send('ID: ' + data.ID + ' added.');
}


        function updateData(idnumber) {
            var url = "http://localhost:8080/" + idnumber;

            axios.put(url, {
                "Date": document.getElementById("Date").value,
                "Time": document.getElementById("Time").value,
                "PlaceName": document.getElementById("PlaceName").value,
                "Lat": document.getElementById("Lat").value,
                "Lon": document.getElementById("Lon").value,
                "Temperature": document.getElementById("Temperature").value,
                "Humidity": document.getElementById("Humidity").value
            })
                .then(response => { })
                .catch(error => alert("Try again"));
            socket.send('ID: ' + idnumber + ' updated.');
        }

        function deleteById(idnumber) {
            var url = 'http://localhost:8080/' + idnumber;

            axios.delete(url)
                .then(response => { })
                .catch(error => alert('Try again'));
            socket.send('ID: ' + idnumber + ' deleted.');
        }


        // Function to set up Tabulator table with data
        function setTable(data) {
            $("#tabel").tabulator({
                layout: "fitDataFill",
                height: "311px",
                columns: [
                    { title: "ID", field: "ID" },
                    { title: "Date", field: "Date" },
                    { title: "Time", field: "Time" },
                    { title: "PlaceName", field: "PlaceName" },
                    { title: "Lat", field: "Lat" },
                    { title: "Lon", field: "Lon" },
                    { title: "Temperature", field: "Temperature" },
                    { title: "Humidity", field: "Humidity" }
                ],


            });
            $("#tabel").tabulator("setData", data);
        }

    </script>
</body>

</html>